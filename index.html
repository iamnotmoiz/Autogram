<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ghost - Demo</title>
    
    <!-- 1. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    keyframes: {
                        'slide-up-fade': {
                            '0%': { opacity: 0, transform: 'translateY(20px) scale(0.98)' },
                            '100%': { opacity: 1, transform: 'translateY(0) scale(1)' },
                        },
                        'scale-in': {
                            '0%': { opacity: 0, transform: 'scale(0.9)' },
                            '100%': { opacity: 1, transform: 'scale(1)' },
                        },
                        'pulse-glow': {
                            '0%, 100%': { opacity: 0.5, transform: 'scale(1)' },
                            '50%': { opacity: 1, transform: 'scale(1.1)' },
                        },
                        'progress': {
                            '0%': { width: '0%' },
                            '100%': { width: '100%' },
                        }
                    },
                    animation: {
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'slide-up': 'slide-up-fade 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'scale-in': 'scale-in 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                        'pulse-glow': 'pulse-glow 2s ease-in-out infinite',
                        'progress': 'progress 2s ease-out forwards',
                    },
                    fontFamily: {
                        sans: ['-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', 'sans-serif'],
                    },
                    transitionTimingFunction: {
                        'spring': 'cubic-bezier(0.34, 1.56, 0.64, 1)',
                    }
                }
            }
        }
    </script>

    <!-- 2. Import Map for React & Lucide Icons -->
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.263.1"
        }
    }
    </script>

    <!-- 3. Babel for compiling JSX in browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        body { background-color: black; margin: 0; overscroll-behavior-y: none; }
        
        .picker-mask {
            -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 20%, black 80%, transparent 100%);
            mask-image: linear-gradient(to bottom, transparent 0%, black 20%, black 80%, transparent 100%);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- 4. The Application Logic -->
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef, useCallback, useMemo, useLayoutEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            Instagram, Wand2, Calendar, Settings, LogOut, CheckCircle2, 
            Image as ImageIcon, Send, Loader2, BarChart3, Trash2, TrendingUp, 
            Users, Eye, Clock, Upload, User, Edit3, X, Plus, Moon, Sun, 
            Shield, Smartphone, Check, Play, Square, History, Hourglass, Zap, Key, ExternalLink, AlertTriangle, HelpCircle, ArrowRight, Film, Info, Ghost
        } from 'lucide-react';

        // --- 1. Shared Hooks ---
        const usePickerEffects = () => {
            const audioContextRef = useRef(null);
            const playClick = useCallback(() => {
                if (navigator.vibrate) navigator.vibrate(2);
                try {
                    if (!audioContextRef.current) audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();
                    const ctx = audioContextRef.current;
                    if (ctx.state === 'suspended') ctx.resume();
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(400, ctx.currentTime);
                    osc.frequency.exponentialRampToValueAtTime(100, ctx.currentTime + 0.05);
                    gain.gain.setValueAtTime(0.05, ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.05);
                    osc.connect(gain);
                    gain.connect(ctx.destination);
                    osc.start();
                    osc.stop(ctx.currentTime + 0.05);
                } catch(e) {}
            }, []);
            return playClick;
        };

        // --- 2. Basic UI Components (No dependencies) ---
        const LoadingScreen = () => {
            return (
                <div className="fixed inset-0 z-[200] bg-black flex flex-col items-center justify-center font-sans">
                    <div className="relative">
                        <div className="w-24 h-24 bg-gradient-to-tr from-indigo-500 to-fuchsia-500 rounded-full blur-xl animate-pulse-glow absolute top-0 left-0"></div>
                        <div className="w-24 h-24 bg-white/5 backdrop-blur-xl border border-white/10 rounded-[2rem] flex items-center justify-center relative z-10 shadow-2xl">
                             <Ghost className="text-white w-10 h-10 animate-bounce" />
                        </div>
                    </div>
                    <h1 className="mt-8 text-2xl font-bold tracking-tight text-white animate-pulse">Ghost</h1>
                    <div className="mt-4 w-48 h-1 bg-neutral-800 rounded-full overflow-hidden">
                        <div className="h-full bg-white animate-progress"></div>
                    </div>
                </div>
            );
        };

        const GlassStat = ({ icon: Icon, label, value, trend, color, theme }) => {
            const glassClass = theme === 'dark' ? 'bg-neutral-900/40 border-white/5' : 'bg-white/60 border-black/5';
            const textMain = theme === 'dark' ? 'text-white' : 'text-neutral-900';
            const textMuted = theme === 'dark' ? 'text-neutral-400' : 'text-neutral-500';
            return (
                <div className={`${glassClass} backdrop-blur-xl border p-6 rounded-[32px] relative overflow-hidden group`}>
                    <div className={`absolute top-0 right-0 p-6 opacity-20 group-hover:opacity-40 transition-opacity ${color}`}><Icon size={48} /></div>
                    <div className="relative z-10">
                        <div className={`text-3xl font-bold mb-1 ${textMain}`}>{value}</div>
                        <div className={`text-sm font-medium mb-4 ${textMuted}`}>{label}</div>
                        <div className={`inline-flex items-center gap-1 text-xs font-bold px-2.5 py-1 rounded-full ${theme === 'dark' ? 'bg-white/5' : 'bg-black/5'} ${color}`}><TrendingUp size={12} /> {trend}</div>
                    </div>
                </div>
            )
        };

        const StyleBar = ({ label, percent, color, theme }) => (
            <div>
                <div className="flex justify-between text-xs font-bold mb-2">
                    <span className={theme === 'dark' ? 'text-neutral-300' : 'text-neutral-600'}>{label}</span>
                    <span className={theme === 'dark' ? 'text-white' : 'text-neutral-900'}>{percent}</span>
                </div>
                <div className={`h-3 rounded-full overflow-hidden border ${theme === 'dark' ? 'bg-black/40 border-white/5' : 'bg-neutral-200 border-black/5'}`}>
                    <div className={`h-full ${color} rounded-full`} style={{ width: percent }}></div>
                </div>
            </div>
        );

        const NavItem = ({ id, icon: Icon, label, count, active, onClick, theme }) => {
            const activeClass = theme === 'dark' ? 'bg-white text-black shadow-lg shadow-white/10' : 'bg-black text-white shadow-lg shadow-black/10';
            const inactiveClass = theme === 'dark' ? 'text-neutral-400 hover:text-white hover:bg-white/5' : 'text-neutral-500 hover:text-black hover:bg-black/5';
            return (
                <button id={id} onClick={onClick} className={`w-full flex items-center gap-4 px-4 py-3.5 rounded-2xl transition-all duration-300 group ${active ? activeClass : inactiveClass}`}>
                    <div className="relative">
                    <Icon size={22} className={active ? 'stroke-[2.5px]' : 'stroke-2'} />
                    {count > 0 && (
                        <span className={`absolute -top-1.5 -right-1.5 text-[9px] w-4 h-4 flex items-center justify-center rounded-full font-bold border ${active ? (theme === 'dark' ? 'bg-black text-white' : 'bg-white text-black') : (theme === 'dark' ? 'bg-white text-black' : 'bg-black text-white')} border-transparent`}>
                        {count}
                        </span>
                    )}
                    </div>
                    <span className={`text-sm font-semibold lg:block hidden ${active ? 'tracking-wide' : ''}`}>{label}</span>
                </button>
            );
        };

        const MobileNavItem = ({ id, icon: Icon, active, onClick, count, theme }) => (
            <button id={id} onClick={onClick} className="relative p-3">
                <div className={`absolute inset-0 rounded-2xl scale-0 transition-transform ${active ? 'scale-100' : ''} ${theme === 'dark' ? 'bg-white/10' : 'bg-black/5'}`}></div>
                <Icon size={24} className={`relative z-10 transition-colors ${active ? (theme === 'dark' ? 'text-white' : 'text-black') : 'text-neutral-500'}`} />
                {count > 0 && (
                    <span className="absolute top-2 right-2 w-2 h-2 bg-indigo-500 rounded-full border border-black"></span>
                )}
            </button>
        );

        const PostCard = ({ post, isPosted, onDelete, glassClass, textTitle, textMuted }) => (
            <div key={post.id} className={`${glassClass} backdrop-blur-xl border p-4 rounded-[24px] flex gap-4 group hover:scale-[1.02] transition-all duration-300 ease-spring`}>
                <div className="w-24 h-24 shrink-0 rounded-2xl overflow-hidden shadow-lg bg-neutral-800">
                    <img src={post.imageUrl} alt="Thumbnail" className="w-full h-full object-cover" />
                </div>
                <div className="flex-1 min-w-0 flex flex-col justify-between py-1">
                    <div>
                        <span className={`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider mb-2 border ${isPosted ? 'bg-blue-500/20 text-blue-400 border-blue-500/10' : 'bg-green-500/20 text-green-500 border-green-500/10'}`}>
                            {isPosted ? <Check size={12} /> : <Hourglass size={12} />} 
                            {isPosted ? 'Posted' : 'Upcoming'}
                        </span>
                        <h4 className={`font-medium truncate text-sm ${textTitle}`}>{new Date(post.date).toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })}</h4>
                        <p className={`${textMuted} text-xs mt-0.5`}>{new Date(post.date).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</p>
                    </div>
                    <div className="flex justify-end"><button onClick={() => onDelete(post.id)} className={`${textMuted} hover:text-red-400 transition-colors p-2`} title="Remove"><Trash2 size={16} /></button></div>
                </div>
            </div>
        );

        // --- 3. Complex UI Components (Depend on basic components/hooks) ---
        
        const RouletteWheel = ({ items, selectedValue, onSelect, label, theme }) => {
            const containerRef = useRef(null);
            const playClick = usePickerEffects();
            const ITEM_HEIGHT = 40; 
            const VISIBLE_ITEMS = 5; 
            
            useEffect(() => {
                if (containerRef.current) {
                    const index = items.findIndex(i => i.value === selectedValue);
                    if (index !== -1) containerRef.current.scrollTop = index * ITEM_HEIGHT;
                }
            }, []);

            const handleScroll = () => {
                if (!containerRef.current) return;
                const scrollTop = containerRef.current.scrollTop;
                const index = Math.round(scrollTop / ITEM_HEIGHT);
                if (index >= 0 && index < items.length) {
                    const item = items[index];
                    if (item && item.value !== selectedValue) {
                        onSelect(item.value);
                        playClick();
                    }
                }
            };
            const bgGlass = theme === 'dark' ? 'bg-white/10' : 'bg-black/5';
            const textActive = theme === 'dark' ? 'text-white' : 'text-black';
            const textPassive = 'text-neutral-500';

            return (
                <div className="flex flex-col items-center gap-1 relative z-10 w-16">
                    {label && <span className="text-[9px] font-bold uppercase tracking-widest text-neutral-500">{label}</span>}
                    <div className="relative w-full overflow-hidden picker-mask" style={{ height: `${ITEM_HEIGHT * VISIBLE_ITEMS}px` }}>
                        <div className={`absolute top-1/2 left-0 right-0 -translate-y-1/2 rounded-md pointer-events-none z-0 border-y border-white/5 ${bgGlass}`} style={{ height: `${ITEM_HEIGHT}px` }} />
                        <div ref={containerRef} className="h-full w-full overflow-y-auto no-scrollbar snap-y snap-mandatory relative z-10" onScroll={handleScroll} style={{ paddingBlock: `${(ITEM_HEIGHT * VISIBLE_ITEMS - ITEM_HEIGHT) / 2}px` }}>
                            {items.map((item, i) => {
                                const isSelected = item.value === selectedValue;
                                const offset = items.findIndex(x => x.value === selectedValue) - i;
                                const rotateX = offset * 25; 
                                return (
                                    <div key={item.value} className={`flex items-center justify-center snap-center cursor-pointer transition-all duration-200 ease-out select-none ${isSelected ? `font-semibold text-xl ${textActive}` : `font-medium text-lg ${textPassive} opacity-50`}`} style={{ height: `${ITEM_HEIGHT}px`, transform: `perspective(500px) rotateX(${rotateX}deg) scale(${isSelected ? 1.1 : 0.9})`, transformOrigin: 'center center' }} onClick={() => { if (containerRef.current) containerRef.current.scrollTo({ top: i * ITEM_HEIGHT, behavior: 'smooth' }); }}>{item.label}</div>
                                );
                            })}
                        </div>
                    </div>
                </div>
            );
        };

        const TooltipSystem = ({ active, onComplete, onStepChange }) => {
            const [step, setStep] = useState(0);
            const [coords, setCoords] = useState(null);
            
            const steps = [
                { id: 'nav-generate', text: "Start here to create content.", position: "right" },
                { id: 'action-autopilot', text: "Set it and forget it. Automate your posts.", position: "bottom" },
                { id: 'action-generate', text: "Customize prompt & style manually.", position: "bottom" },
                { id: 'nav-schedule', text: "View your queue & history.", position: "right" },
                { id: 'nav-settings', text: "Configure API keys here.", position: "right" }
            ];

            useEffect(() => {
                if (!active) return;
                const updatePosition = () => {
                    if (!steps[step]) return;
                    const targetId = steps[step].id;
                    const el = document.getElementById(targetId);
                    if (el) {
                        const rect = el.getBoundingClientRect();
                        if (rect.width > 0 && rect.height > 0) {
                            setCoords(rect);
                        }
                        onStepChange(targetId); 
                    }
                };
                
                const timer = setTimeout(updatePosition, 350); 
                window.addEventListener('resize', updatePosition);
                return () => {
                    clearTimeout(timer);
                    window.removeEventListener('resize', updatePosition);
                }
            }, [step, active]);

            if (!active || !coords || !steps[step]) return null;

            const isMobile = window.innerWidth < 768;
            const currentTip = steps[step];
            let top, left, transform;
            
            if (isMobile) {
                if (currentTip.id.startsWith('nav-')) {
                   top = coords.top - 20;
                   left = coords.left + (coords.width / 2);
                   transform = 'translate(-50%, -100%)';
                } else {
                   top = coords.top - 10;
                   left = coords.left + (coords.width / 2);
                   transform = 'translate(-50%, -100%)';
                }
                 if(currentTip.id === 'action-autopilot') {
                    top = coords.bottom + 10;
                    left = coords.left + (coords.width / 2);
                    transform = 'translate(-50%, 0)';
                }
            } else {
                if (currentTip.position === 'bottom') {
                    top = coords.bottom + 10;
                    left = coords.left + (coords.width / 2);
                    transform = 'translate(-50%, 0)';
                } else {
                    top = coords.top + (coords.height / 2);
                    left = coords.right + 10;
                    transform = 'translate(0, -50%)';
                }
            }

            const handleNext = () => {
                if (step < steps.length - 1) setStep(step + 1);
                else onComplete();
            };

            const holeX = coords.left + coords.width/2;
            const holeY = coords.top + coords.height/2;
            const holeSize = Math.max(coords.width, coords.height)/2 + 10;

            return (
                <div className="fixed inset-0 z-[160] pointer-events-none">
                    <div className="absolute inset-0 bg-black/60 transition-all duration-500 ease-in-out" style={{ maskImage: `radial-gradient(circle at ${holeX}px ${holeY}px, transparent ${holeSize}px, black ${holeSize + 5}px)`, WebkitMaskImage: `radial-gradient(circle at ${holeX}px ${holeY}px, transparent ${holeSize}px, black ${holeSize + 5}px)` }} />
                    <div className="absolute bg-white text-black p-4 rounded-2xl shadow-2xl w-48 pointer-events-auto flex flex-col gap-3 animate-scale-in origin-center" style={{ top: top, left: left, transform: transform, marginTop: 0 }}>
                         <div className="flex justify-between items-start"><p className="text-xs font-semibold">{currentTip.text}</p><button onClick={onComplete} className="text-[10px] font-bold text-neutral-400 hover:text-black uppercase tracking-wider ml-2">Skip</button></div>
                        <div className="flex justify-between items-center"><span className="text-[10px] text-neutral-500">{step + 1} / {steps.length}</span><button onClick={handleNext} className="bg-black text-white p-1.5 rounded-full hover:bg-neutral-800 transition-colors"><ArrowRight size={12} /></button></div>
                        <div className="absolute w-3 h-3 bg-white rotate-45" style={isMobile ? { ...(currentTip.id === 'action-autopilot' ? {top: -6, left: '50%', transform: 'translateX(-50%)'} : {bottom: -6, left: '50%', transform: 'translateX(-50%)'}) } : { ...(currentTip.position === 'bottom' ? {top: -6, left: '50%', transform: 'translateX(-50%)'} : {left: -6, top: '50%', transform: 'translateY(-50%)'}) }} />
                    </div>
                </div>
            );
        };

        const TutorialModal = ({ onClose, theme }) => {
            const [slide, setSlide] = useState(0);
            const [isExiting, setIsExiting] = useState(false);
            
            const slides = [
                { title: "Welcome to Ghost", desc: "Your autonomous AI social media manager.", icon: <Ghost size={48} className="text-indigo-500" /> },
                { title: "Auto-Pilot Mode", desc: "Set a topic and frequency. Ghost generates content automatically.", icon: <Zap size={48} className="text-yellow-500" /> },
                { title: "Smart Scheduler", desc: "Review your content queue and history in the Calendar tab.", icon: <Calendar size={48} className="text-green-500" /> },
                { title: "Unlock Pro Quality", desc: "Add your Google Gemini API Key in Settings for pro-level generation.", icon: <Key size={48} className="text-pink-500" /> }
            ];

            const handleNext = () => {
                setIsExiting(true);
                setTimeout(() => {
                    if (slide < slides.length - 1) { setSlide(slide + 1); setIsExiting(false); } else { onClose(); }
                }, 300);
            };

            const bgClass = theme === 'dark' ? 'bg-neutral-900/95 border-white/10 text-white' : 'bg-white/95 border-black/10 text-neutral-900';
            const textMuted = theme === 'dark' ? 'text-neutral-400' : 'text-neutral-500';
            const contentTransition = isExiting ? "opacity-0 -translate-x-4 scale-95 duration-300 ease-in" : "opacity-100 translate-x-0 scale-100 duration-500 ease-spring delay-75";
            const iconTransition = isExiting ? "opacity-0 rotate-[-45deg] scale-50 duration-300" : "opacity-100 rotate-0 scale-100 duration-500 ease-spring delay-100";

            return (
                <div className="fixed inset-0 z-[150] flex items-center justify-center p-6 animate-scale-in">
                    <div className="absolute inset-0 bg-black/80 backdrop-blur-sm transition-opacity duration-500" onClick={onClose}></div>
                    <div className={`relative w-full max-w-sm rounded-[32px] border p-8 shadow-2xl overflow-hidden flex flex-col items-center text-center transition-all duration-500 ease-spring ${bgClass}`}>
                        <button onClick={onClose} className={`absolute top-6 right-6 text-xs font-bold uppercase tracking-widest hover:opacity-70 ${textMuted}`}>Skip</button>
                        <div className={`mt-8 mb-6 h-20 flex items-center justify-center perspective-1000`}><div className={`transform transition-all ${iconTransition}`}>{slides[slide].icon}</div></div>
                        <div className={`transform transition-all ${contentTransition}`}><h3 className="text-2xl font-bold mb-3">{slides[slide].title}</h3><p className={`text-sm leading-relaxed mb-8 ${textMuted}`}>{slides[slide].desc}</p></div>
                        <div className="flex gap-2 mb-8">{slides.map((_, i) => (<div key={i} className={`h-2 rounded-full transition-all duration-500 ease-spring ${i === slide ? (theme === 'dark' ? 'bg-white w-6' : 'bg-black w-6') : (theme === 'dark' ? 'bg-white/20 w-2' : 'bg-black/20 w-2')}`} />))}</div>
                        <button onClick={handleNext} className={`w-full py-4 rounded-2xl font-bold text-sm transition-transform active:scale-95 ${theme === 'dark' ? 'bg-white text-black hover:bg-neutral-200' : 'bg-black text-white hover:bg-neutral-800'}`}>{slide === slides.length - 1 ? "Get Started" : "Next"}</button>
                    </div>
                </div>
            );
        };

        const AutoPilotStatus = ({ autoPilot, theme, onPostTrigger, onStop }) => {
            const [timeLeft, setTimeLeft] = useState("");
            const triggerLock = useRef(false);

            useEffect(() => {
                const interval = setInterval(() => {
                    if (autoPilot.nextPostTime) {
                        const now = new Date();
                        const diff = autoPilot.nextPostTime - now;
                        if (diff > 0) {
                            triggerLock.current = false;
                            const h = Math.floor((diff % (1000*60*60*24))/(1000*60*60));
                            const m = Math.floor((diff % (1000*60*60))/(1000*60));
                            const s = Math.floor((diff % (1000*60))/1000);
                            setTimeLeft(`${h}h ${m}m ${s}s`);
                        } else {
                            setTimeLeft("Posting...");
                            if (!triggerLock.current) { triggerLock.current = true; onPostTrigger(); }
                        }
                    }
                }, 1000);
                return () => clearInterval(interval);
            }, [autoPilot.nextPostTime, onPostTrigger]);

            return (
                <div className="bg-black text-white rounded-full pl-4 pr-2 py-2 shadow-2xl border border-white/10 flex items-center justify-between animate-in slide-in-from-top-4 duration-500 gap-4">
                    <div className="flex items-center gap-3">
                        <div className="relative"><div className="w-2.5 h-2.5 bg-green-500 rounded-full animate-pulse"></div><div className="absolute inset-0 bg-green-500 rounded-full animate-ping opacity-50"></div></div>
                        <div><div className="text-[10px] text-neutral-400 font-bold uppercase tracking-wider leading-none">Auto-Pilot</div><div className="text-xs font-semibold leading-tight truncate max-w-[120px]">{autoPilot.topic}</div></div>
                    </div>
                    <div className="flex items-center gap-2">
                        <div className="flex items-center gap-2 bg-white/10 px-3 py-1.5 rounded-full"><Clock size={12} className="text-neutral-300" /><span className="text-xs font-mono font-medium min-w-[60px] text-center">{timeLeft}</span></div>
                        <button onClick={onStop} className="p-2 bg-red-500/20 hover:bg-red-500 text-red-500 hover:text-white rounded-full transition-all active:scale-95"><Square size={12} fill="currentColor" /></button>
                    </div>
                </div>
            );
        };

        const AutoPilotConfigModal = ({ theme, onClose, onConfirm }) => {
            const [hours, setHours] = useState(0);
            const [minutes, setMinutes] = useState(0);
            const [seconds, setSeconds] = useState(30);
            const hourItems = useMemo(() => Array.from({length: 25}, (_, i) => ({ value: i, label: i.toString() })), []);
            const minSecItems = useMemo(() => Array.from({length: 60}, (_, i) => ({ value: i, label: i.toString().padStart(2, '0') })), []);

            const handleStart = () => {
                const totalMs = ((hours * 60 * 60) + (minutes * 60) + seconds) * 1000;
                if (totalMs < 30000) return alert("Minimum frequency is 30 seconds.");
                onConfirm(totalMs);
            };

            const bgClass = theme === 'dark' ? 'bg-neutral-900 border-white/10' : 'bg-white border-black/10';
            const textMain = theme === 'dark' ? 'text-white' : 'text-neutral-900';

            return (
                <div className="fixed inset-0 z-[100] flex items-end md:items-center justify-center sm:p-4 animate-scale-in">
                    <div className="absolute inset-0 bg-black/60 backdrop-blur-md" onClick={onClose}></div>
                    <div className={`${bgClass} border p-6 md:p-8 rounded-t-[32px] md:rounded-[32px] w-full max-w-md shadow-2xl relative animate-in slide-in-from-bottom-10 duration-300`}>
                        <div className="flex justify-between items-center mb-6">
                            <h3 className={`text-2xl font-bold ${textMain}`}>Auto-Pilot Frequency</h3>
                            <button onClick={onClose} className={`p-2 rounded-full transition-colors ${theme === 'dark' ? 'bg-white/10 hover:bg-white/20' : 'bg-black/5 hover:bg-black/10'}`}><X size={20} className={textMain}/></button>
                        </div>
                        <div className="space-y-8">
                            <div className="bg-blue-500/10 p-4 rounded-2xl flex gap-3 text-sm text-blue-400 border border-blue-500/20"><Zap className="shrink-0 mt-0.5" size={18} /><p>Set generation interval. Minimum 30s.</p></div>
                            <div className={`rounded-3xl p-6 flex items-center justify-center gap-2 md:gap-6 ${theme === 'dark' ? 'bg-black/30' : 'bg-neutral-100'}`}>
                                <RouletteWheel items={hourItems} selectedValue={hours} onSelect={setHours} label="Hours" theme={theme} />
                                <span className="text-2xl font-light opacity-30 mt-4">:</span>
                                <RouletteWheel items={minSecItems} selectedValue={minutes} onSelect={setMinutes} label="Mins" theme={theme} />
                                <span className="text-2xl font-light opacity-30 mt-4">:</span>
                                <RouletteWheel items={minSecItems} selectedValue={seconds} onSelect={setSeconds} label="Secs" theme={theme} />
                            </div>
                            <button onClick={handleStart} className={`w-full h-14 rounded-2xl font-bold transition-all active:scale-95 text-lg flex items-center justify-center gap-2 ${theme === 'dark' ? 'bg-white hover:bg-neutral-200 text-black' : 'bg-black hover:bg-neutral-800 text-white'}`}><Play size={20} fill="currentColor" /> Start Auto-Pilot</button>
                        </div>
                    </div>
                </div>
            );
        };

        const LoginScreen = ({ onLogin, theme }) => {
            const [loading, setLoading] = useState(false);
            const [mode, setMode] = useState('demo');
            const [formData, setFormData] = useState({ username: '', followers: '100', avatar: '' });
            const handleDemoLogin = () => { setLoading(true); setTimeout(() => onLogin(null), 1500); };
            const handleCustomLogin = (e) => {
                e.preventDefault();
                if(!formData.username) return;
                setLoading(true);
                setTimeout(() => onLogin({ username: formData.username, name: formData.username, followers: formData.followers, avatar: formData.avatar || `https://api.dicebear.com/7.x/initials/svg?seed=${formData.username}` }), 1000);
            };

            return (
                <div className="min-h-screen bg-black flex items-center justify-center p-6 relative overflow-hidden font-sans">
                    <div className="absolute inset-0 z-0"><div className="absolute top-[-20%] left-[-10%] w-[80%] h-[80%] bg-indigo-600/20 rounded-full blur-[150px]"></div><div className="absolute bottom-[-10%] right-[-10%] w-[60%] h-[60%] bg-fuchsia-600/20 rounded-full blur-[150px]"></div></div>
                    <div className="w-full max-w-sm bg-white/5 backdrop-blur-3xl border border-white/10 p-8 rounded-[40px] shadow-2xl relative z-10">
                        <div className="text-center mb-10"><div className="w-20 h-20 bg-purple-600 rounded-3xl mx-auto mb-6 flex items-center justify-center shadow-lg"><Ghost className="text-white w-10 h-10" /></div><h1 className="text-3xl font-bold text-white mb-2">Ghost</h1><p className="text-neutral-400 text-sm">Touch grass. We'll post.</p></div>
                        <div className="flex bg-black/20 p-1.5 rounded-2xl mb-8 relative"><div className={`absolute top-1.5 bottom-1.5 w-[calc(50%-6px)] bg-neutral-800 rounded-xl shadow-lg transition-all duration-300 ease-out ${mode === 'demo' ? 'left-1.5' : 'left-[calc(50%+3px)]'}`}></div><button onClick={() => setMode('demo')} className={`flex-1 py-2.5 text-xs font-semibold rounded-xl relative z-10 transition-colors ${mode === 'demo' ? 'text-white' : 'text-neutral-400'}`}>Demo Mode</button><button onClick={() => setMode('custom')} className={`flex-1 py-2.5 text-xs font-semibold rounded-xl relative z-10 transition-colors ${mode === 'custom' ? 'text-white' : 'text-neutral-400'}`}>Live Mode</button></div>
                        {mode === 'demo' ? (
                            <div className="space-y-4 animate-in fade-in slide-in-from-bottom-4 duration-500"><button onClick={handleDemoLogin} disabled={loading} className="w-full h-14 bg-white hover:bg-neutral-100 text-black rounded-2xl font-bold transition-all active:scale-95 flex items-center justify-center gap-2 group shadow-xl shadow-white/5">{loading ? <Loader2 className="animate-spin text-black" /> : <span>Enter Dashboard</span>}</button></div>
                        ) : (
                            <form onSubmit={handleCustomLogin} className="space-y-4 animate-in fade-in slide-in-from-right-4 duration-500">
                                <div className="space-y-3"><input type="text" required className="w-full bg-black/20 border border-white/5 rounded-2xl h-14 px-5 text-white placeholder-neutral-500 focus:bg-black/40 focus:border-white/20 outline-none transition-all text-base" style={{fontSize: '16px'}} placeholder="Instagram Username" value={formData.username} onChange={e => setFormData({...formData, username: e.target.value})} /><input type="text" required className="w-full bg-black/20 border border-white/5 rounded-2xl h-14 px-5 text-white placeholder-neutral-500 focus:bg-black/40 focus:border-white/20 outline-none transition-all text-base" style={{fontSize: '16px'}} placeholder="Follower Count" value={formData.followers} onChange={e => setFormData({...formData, followers: e.target.value})} /><input type="url" className="w-full bg-black/20 border border-white/5 rounded-2xl h-14 px-5 text-white placeholder-neutral-500 focus:bg-black/40 focus:border-white/20 outline-none transition-all text-base" style={{fontSize: '16px'}} placeholder="Avatar URL (Optional)" value={formData.avatar} onChange={e => setFormData({...formData, avatar: e.target.value})} /></div>
                                <button type="submit" disabled={loading} className="w-full h-14 bg-gradient-to-r from-indigo-500 to-fuchsia-500 hover:opacity-90 text-white rounded-2xl font-bold transition-all active:scale-95 flex items-center justify-center gap-2 mt-4 shadow-lg shadow-indigo-500/20">{loading ? <Loader2 className="animate-spin" /> : <span>Launch</span>}</button>
                            </form>
                        )}
                    </div>
                </div>
            );
        };

        const Generator = ({ user, onSchedule, theme, autoPilot, setAutoPilot, setShowAutoPilotModal, setPendingAutoTopic, pendingAutoTopic, generateGeminiCaption, generateImage }) => {
            const [topic, setTopic] = useState("");
            const [style, setStyle] = useState("Hyper Realistic");
            const [isGenerating, setIsGenerating] = useState(false);
            const [isCaptionLoading, setIsCaptionLoading] = useState(false);
            const [result, setResult] = useState(null);
            const [faceImage, setFaceImage] = useState(null);
            const [editedCaption, setEditedCaption] = useState("");
            const [showScheduleModal, setShowScheduleModal] = useState(false);
            const glassClass = theme === 'dark' ? 'bg-neutral-900/40 border-white/10' : 'bg-white/60 border-black/5';
            const inputClass = theme === 'dark' ? 'bg-black/30 border-white/5 text-white placeholder-neutral-600 focus:bg-black/50' : 'bg-white/80 border-black/5 text-black placeholder-neutral-400 focus:bg-white';
            const textMuted = theme === 'dark' ? 'text-neutral-400' : 'text-neutral-500';

            const handleFaceUpload = (e) => { const file = e.target.files[0]; if (file) { const reader = new FileReader(); reader.onloadend = () => setFaceImage(reader.result); reader.readAsDataURL(file); } };
            const handleGenerate = async () => {
                if (!topic) return;
                setIsGenerating(true); setResult(null);
                const seed = Math.floor(Math.random() * 10000);
                const facePrompt = faceImage ? "resembling uploaded face, " : "";
                const prompt = `hyper realistic photography, ${facePrompt}${topic}, ${style}, 8k`;
                let caption = `âœ¨ ${topic} vibes. #AI #${style.replace(/\s+/g, '')}`;
                const geminiCaption = await generateGeminiCaption(topic, style);
                if (geminiCaption) caption = geminiCaption;
                const img = await generateImage(prompt, seed);
                setTimeout(() => { setResult({ imageUrl: img, caption: caption }); setEditedCaption(caption); setIsGenerating(false); }, 1500);
            };
            const handleRegenerateCaption = async () => { if(!topic) return; setIsCaptionLoading(true); const newCap = await generateGeminiCaption(topic, style); if(newCap) setEditedCaption(newCap); setIsCaptionLoading(false); };
            const confirmSchedule = (date) => { onSchedule({ ...result, caption: editedCaption, date: date.toISOString(), status: 'scheduled' }); setShowScheduleModal(false); setResult(null); setTopic(""); };
            const triggerAutoPilotConfig = () => { if (autoPilot.active) { setAutoPilot({ ...autoPilot, active: false, nextPostTime: null }); return; } if (!pendingAutoTopic) return alert("Enter topic"); setShowAutoPilotModal(true); };

            return (
                <div className="animate-in fade-in duration-700 space-y-6 md:space-y-8">
                    <div className="flex flex-col md:flex-row md:items-end justify-between gap-4">
                        <div><h2 className={`text-3xl md:text-4xl font-bold tracking-tight bg-clip-text text-transparent bg-gradient-to-r ${theme === 'dark' ? 'from-white to-neutral-500' : 'from-neutral-900 to-neutral-500'}`}>Create</h2><p className={`${textMuted} mt-1`}>Design viral content in seconds.</p></div>
                        <div id="action-autopilot" className={`${glassClass} backdrop-blur-md border p-1.5 pl-4 pr-1.5 rounded-full flex items-center justify-between gap-4 shadow-sm w-full md:w-auto`}>
                            <div className="flex items-center gap-2"><div className={`w-2 h-2 rounded-full ${autoPilot.active ? 'bg-green-500 animate-pulse' : 'bg-neutral-400'}`}></div><span className={`text-xs font-medium ${theme === 'dark' ? 'text-neutral-300' : 'text-neutral-600'}`}>Auto-Pilot</span></div>
                            {autoPilot.active ? <button onClick={() => setAutoPilot(prev => ({...prev, active: false}))} className="bg-red-500/10 hover:bg-red-500/20 text-red-500 px-4 py-2 rounded-full text-xs font-semibold transition-colors">Stop</button> : <div className="flex items-center gap-2 flex-1 justify-end"><input type="text" placeholder="Topic..." value={pendingAutoTopic} onChange={(e) => setPendingAutoTopic(e.target.value)} className={`bg-transparent text-sm w-full md:w-20 outline-none text-right mr-2 ${theme === 'dark' ? 'text-white' : 'text-black'}`} style={{fontSize:'16px'}} /><button onClick={triggerAutoPilotConfig} className={`${theme === 'dark' ? 'bg-white text-black' : 'bg-black text-white'} px-4 py-2 rounded-full text-xs font-bold`}>Start</button></div>}
                        </div>
                    </div>
                    <div className="grid grid-cols-1 xl:grid-cols-12 gap-6 md:gap-8">
                        <div className="xl:col-span-7 space-y-6">
                            <div className={`${glassClass} backdrop-blur-xl border p-6 md:p-8 rounded-[32px] shadow-2xl space-y-8`}>
                                <div><label className={`block text-xs font-bold uppercase tracking-widest mb-3 pl-1 ${textMuted}`}>Prompt</label><textarea value={topic} onChange={(e) => setTopic(e.target.value)} placeholder="Describe your vision..." className={`w-full rounded-3xl p-5 text-lg outline-none h-32 resize-none transition-all shadow-inner border ${inputClass}`} style={{fontSize:'16px'}} /></div>
                                <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <div><label className={`block text-xs font-bold uppercase tracking-widest mb-3 pl-1 ${textMuted}`}>Aesthetic</label><div className="relative"><select value={style} onChange={(e) => setStyle(e.target.value)} className={`w-full appearance-none rounded-2xl p-4 text-sm font-medium outline-none border transition-all ${inputClass}`}>{["Hyper Realistic", "Cinematic", "Cyberpunk", "Minimalist"].map(s=><option key={s} value={s}>{s}</option>)}</select></div></div>
                                    <div><label className={`block text-xs font-bold uppercase tracking-widest mb-3 pl-1 ${textMuted}`}>Face Ref</label><div className="relative h-[54px]"><input type="file" accept="image/*" onChange={handleFaceUpload} className="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-20" /><div className={`absolute inset-0 rounded-2xl border border-dashed flex items-center justify-center gap-3 text-xs font-medium ${faceImage ? 'border-indigo-500/50 text-indigo-400' : `${theme==='dark'?'border-white/10':'border-black/10'} ${textMuted}`}`}>{faceImage ? "Active" : "Upload"}</div></div></div>
                                </div>
                                <button id="action-generate" onClick={handleGenerate} disabled={isGenerating||!topic} className={`w-full h-16 rounded-[24px] font-bold text-lg flex items-center justify-center gap-3 transition-all ${isGenerating||!topic?'opacity-50 cursor-not-allowed':''} ${theme==='dark'?'bg-white text-black':'bg-black text-white'}`}>{isGenerating?<Loader2 className="animate-spin"/>:"Generate"}</button>
                            </div>
                        </div>
                        <div className="xl:col-span-5">
                            {!result && !isGenerating && <div className={`h-full min-h-[400px] border border-dashed rounded-[32px] flex flex-col items-center justify-center gap-4 ${glassClass} ${textMuted}`}><ImageIcon size={32} className="opacity-50"/><p>Canvas Empty</p></div>}
                            {isGenerating && <div className={`h-full min-h-[400px] backdrop-blur-xl border rounded-[32px] flex flex-col items-center justify-center gap-6 ${glassClass}`}><div className="w-24 h-24 border-4 rounded-full animate-spin border-t-transparent border-white/20"></div></div>}
                            {result && <div className={`backdrop-blur-2xl border rounded-[32px] overflow-hidden shadow-2xl ${glassClass}`}>
                                <img src={result.imageUrl} className="w-full aspect-[4/5] object-cover" />
                                <div className="p-6 space-y-6">
                                    <div className="flex justify-between items-center"><span className={`text-xs font-bold uppercase tracking-widest ${textMuted}`}>Caption</span><button onClick={handleRegenerateCaption} disabled={isCaptionLoading} className="text-xs font-medium flex items-center gap-1">{isCaptionLoading?<Loader2 size={12} className="animate-spin"/>:<Wand2 size={12}/>} Generate Caption</button></div>
                                    <textarea value={editedCaption} onChange={e=>setEditedCaption(e.target.value)} className="w-full bg-transparent text-sm h-24 resize-none outline-none" />
                                    <button onClick={()=>setShowScheduleModal(true)} className="w-full py-3 bg-indigo-600 hover:bg-indigo-500 text-white rounded-2xl font-bold">Schedule</button>
                                </div>
                            </div>}
                        </div>
                    </div>
                    {showScheduleModal && <ModernDatePicker onClose={()=>setShowScheduleModal(false)} onConfirm={confirmSchedule} theme={theme} />}
                </div>
            );
        };

        const ModernDatePicker = ({ onClose, onConfirm, theme }) => {
            const [selectedDate, setSelectedDate] = useState(0); 
            const [selectedHour, setSelectedHour] = useState(12);
            const [selectedMinute, setSelectedMinute] = useState(0);
            const [amPm, setAmPm] = useState('PM');
            
            const dayItems = useMemo(() => ['Today', 'Tomorrow', 'In 2 Days', 'In 3 Days', 'In 4 Days'].map((label, i) => ({ value: i, label })), []);
            const hourItems = useMemo(() => Array.from({length: 12}, (_, i) => ({ value: i + 1, label: (i + 1).toString() })), []);
            const minItems = useMemo(() => [0, 15, 30, 45].map(m => ({ value: m, label: m.toString().padStart(2, '0') })), []);
            const amPmItems = useMemo(() => [{value: 'AM', label: 'AM'}, {value: 'PM', label: 'PM'}], []);

            const handleConfirm = () => {
                const date = new Date();
                date.setDate(date.getDate() + selectedDate);
                let hour24 = selectedHour;
                if (amPm === 'PM' && selectedHour !== 12) hour24 += 12;
                if (amPm === 'AM' && selectedHour === 12) hour24 = 0;
                date.setHours(hour24, selectedMinute, 0, 0);
                onConfirm(date);
            };

            const bgClass = theme === 'dark' ? 'bg-neutral-900 border-white/10' : 'bg-white border-black/10';
            const textMain = theme === 'dark' ? 'text-white' : 'text-neutral-900';
            const activeChip = theme === 'dark' ? 'bg-white text-black' : 'bg-black text-white';
            const inactiveChip = theme === 'dark' ? 'bg-white/5 text-neutral-400' : 'bg-black/5 text-neutral-600';

            return (
                <div className="fixed inset-0 z-[100] flex items-end md:items-center justify-center sm:p-4 animate-scale-in">
                    <div className="absolute inset-0 bg-black/60 backdrop-blur-md" onClick={onClose}></div>
                    <div className={`${bgClass} border p-6 md:p-8 rounded-t-[32px] md:rounded-[32px] w-full max-w-md shadow-2xl relative flex flex-col max-h-[85vh]`}>
                        <div className="flex justify-between items-center mb-6">
                            <h3 className={`text-2xl font-bold ${textMain}`}>Schedule</h3>
                            <button onClick={onClose} className={`p-2 rounded-full transition-colors ${theme === 'dark' ? 'bg-white/10' : 'bg-black/5'}`}><X size={20} className={textMain}/></button>
                        </div>
                        <div className="space-y-8 flex-1 overflow-y-auto no-scrollbar">
                            <div className="flex overflow-x-auto no-scrollbar gap-2 pb-2">
                                {dayItems.map((day, i) => (
                                    <button key={i} onClick={() => setSelectedDate(day.value)} className={`px-4 py-2 rounded-full text-sm font-semibold whitespace-nowrap transition-colors ${selectedDate === day.value ? activeChip : inactiveChip}`}>{day.label}</button>
                                ))}
                            </div>
                            <div className={`rounded-3xl p-6 flex items-center justify-center gap-2 md:gap-6 ${theme === 'dark' ? 'bg-black/30' : 'bg-neutral-100'}`}>
                                <RouletteWheel items={hourItems} selectedValue={selectedHour} onSelect={setSelectedHour} label="Hr" theme={theme} />
                                <span className="text-2xl font-light opacity-30 mt-4">:</span>
                                <RouletteWheel items={minItems} selectedValue={selectedMinute} onSelect={setSelectedMinute} label="Min" theme={theme} />
                                <span className="text-2xl font-light opacity-30 mt-4">:</span>
                                <RouletteWheel items={amPmItems} selectedValue={amPm} onSelect={setAmPm} label="Meridiem" theme={theme} />
                            </div>
                            <button onClick={handleConfirm} className={`w-full h-14 rounded-2xl font-bold transition-all active:scale-95 text-lg ${theme === 'dark' ? 'bg-white text-black' : 'bg-black text-white'}`}>Confirm Schedule</button>
                        </div>
                    </div>
                </div>
            );
        };

        const CustomUploadModal = ({ onClose, onSchedule, theme, generateGeminiCaption }) => {
            const [file, setFile] = useState(null);
            const [previewUrl, setPreviewUrl] = useState(null);
            const [caption, setCaption] = useState("");
            const [isCaptionLoading, setIsCaptionLoading] = useState(false);
            const [showDatePicker, setShowDatePicker] = useState(false);
            const handleFileChange = (e) => { const f = e.target.files[0]; if (f) { setFile(f); const r = new FileReader(); r.onloadend = () => setPreviewUrl(r.result); r.readAsDataURL(f); } };
            const handleGenerateCaption = async () => { if (!caption) return alert("Write a topic."); setIsCaptionLoading(true); const n = await generateGeminiCaption(caption, "social media"); if (n) setCaption(n); setIsCaptionLoading(false); };
            const confirmSchedule = (date) => { if (!previewUrl) return alert("Upload image."); onSchedule({ id: Date.now(), imageUrl: previewUrl, caption: caption, date: date.toISOString(), status: 'scheduled' }); onClose(); };
            const bgClass = theme === 'dark' ? 'bg-neutral-900/95 border-white/10 text-white' : 'bg-white/95 border-black/10 text-neutral-900';
            const textMuted = theme === 'dark' ? 'text-neutral-400' : 'text-neutral-500';

            return (
                <div className="fixed inset-0 z-[150] flex items-center justify-center p-6 animate-scale-in">
                    <div className="absolute inset-0 bg-black/80 backdrop-blur-sm" onClick={onClose}></div>
                    <div className={`relative w-full max-w-md rounded-[32px] border p-6 shadow-2xl overflow-hidden flex flex-col gap-6 ${bgClass}`}>
                         <div className="flex justify-between items-center"><h3 className="text-xl font-bold">Custom Upload</h3><button onClick={onClose} className={`p-2 rounded-full transition-colors ${theme === 'dark' ? 'bg-white/10' : 'bg-black/5'}`}><X size={20} /></button></div>
                        <div className="relative group w-full aspect-video rounded-2xl border-2 border-dashed flex flex-col items-center justify-center overflow-hidden transition-colors border-white/10 bg-black/20 hover:bg-black/30">{previewUrl ? (<img src={previewUrl} className="w-full h-full object-cover" />) : (<div className={`flex flex-col items-center gap-2 ${textMuted}`}><Upload size={32} /><span className="text-xs font-bold uppercase tracking-widest">Upload Image/Video</span></div>)}<input type="file" accept="image/*,video/*" onChange={handleFileChange} className="absolute inset-0 w-full h-full opacity-0 cursor-pointer" /></div>
                        <div className="space-y-2"><div className="flex justify-between items-center"><span className={`text-xs font-bold uppercase tracking-widest ${textMuted}`}>Caption</span><button onClick={handleGenerateCaption} disabled={isCaptionLoading} className={`flex items-center gap-1 text-[10px] font-bold uppercase tracking-widest px-2 py-1 rounded-lg transition-colors ${theme === 'dark' ? 'bg-indigo-500/20 text-indigo-400' : 'bg-indigo-500/10 text-indigo-600'}`}>{isCaptionLoading ? <Loader2 size={10} className="animate-spin" /> : <Wand2 size={10} />} Auto AI Caption</button></div><textarea value={caption} onChange={(e) => setCaption(e.target.value)} placeholder="Write a caption or topic..." className={`w-full bg-transparent border rounded-xl p-3 text-sm resize-none outline-none h-24 ${theme === 'dark' ? 'border-white/10 focus:border-white/30' : 'border-black/10 focus:border-black/30'}`} /></div>
                        <button onClick={() => setShowDatePicker(true)} className={`w-full py-4 rounded-2xl font-bold transition-transform active:scale-95 ${theme === 'dark' ? 'bg-white text-black' : 'bg-black text-white'}`}>Select Date & Time</button>
                    </div>
                     {showDatePicker && <ModernDatePicker onClose={() => setShowDatePicker(false)} onConfirm={confirmSchedule} theme={theme} />}
                </div>
            );
        };

        const Scheduler = ({ posts, onDelete, onAdd, theme, generateGeminiCaption }) => {
            const [showCustomUpload, setShowCustomUpload] = useState(false);
            const textTitle = theme === 'dark' ? 'text-white' : 'text-neutral-900';
            const textMuted = theme === 'dark' ? 'text-neutral-400' : 'text-neutral-500';
            const glassClass = theme === 'dark' ? 'bg-neutral-900/40 border-white/5' : 'bg-white/60 border-black/5';

            const upcomingPosts = posts.filter(p => new Date(p.date) > new Date());
            const postedPosts = posts.filter(p => new Date(p.date) <= new Date()).sort((a,b) => new Date(b.date) - new Date(a.date));

            return (
            <div className="animate-in fade-in duration-700 space-y-12">
                <div>
                    <div className="flex items-center justify-between mb-6">
                        <div><h2 className={`text-3xl md:text-4xl font-bold tracking-tight bg-clip-text text-transparent bg-gradient-to-r ${theme === 'dark' ? 'from-white to-neutral-500' : 'from-neutral-900 to-neutral-500'}`}>Queue</h2><p className={`${textMuted} mt-1`}>Content scheduled for publication.</p></div>
                        <button onClick={() => setShowCustomUpload(true)} className={`flex items-center gap-2 px-4 py-2 rounded-full text-xs font-bold uppercase tracking-widest transition-all hover:scale-105 active:scale-95 ${theme === 'dark' ? 'bg-white text-black hover:bg-neutral-200' : 'bg-black text-white hover:bg-neutral-800'}`}><Plus size={14} /> Custom Upload</button>
                    </div>
                    {upcomingPosts.length === 0 ? <div className={`py-16 flex flex-col items-center justify-center border border-dashed rounded-[32px] ${glassClass} ${textMuted}`}><Calendar size={48} className="mb-4 opacity-50" /><h3 className="text-lg font-bold">Queue Empty</h3><p className="text-xs">Generate posts or upload content.</p></div> : <div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">{upcomingPosts.map(post => <PostCard key={post.id} post={post} isPosted={false} onDelete={onDelete} glassClass={glassClass} textTitle={textTitle} textMuted={textMuted} />)}</div>}
                </div>
                <div>
                    <div className="flex items-center justify-between mb-6"><div><h2 className={`text-3xl md:text-4xl font-bold tracking-tight bg-clip-text text-transparent bg-gradient-to-r ${theme === 'dark' ? 'from-neutral-400 to-neutral-600' : 'from-neutral-600 to-neutral-400'}`}>History</h2><p className={`${textMuted} mt-1`}>Archive of published content.</p></div></div>
                    {postedPosts.length === 0 ? <div className={`py-12 flex flex-col items-center justify-center rounded-[32px] ${textMuted} opacity-60`}><History size={32} className="mb-2" /><span className="text-sm">No history yet</span></div> : <div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 opacity-80 hover:opacity-100 transition-opacity">{postedPosts.map(post => <PostCard key={post.id} post={post} isPosted={true} onDelete={onDelete} glassClass={glassClass} textTitle={textTitle} textMuted={textMuted} />)}</div>}
                </div>
                {showCustomUpload && <CustomUploadModal onClose={() => setShowCustomUpload(false)} onSchedule={onAdd} theme={theme} generateGeminiCaption={generateGeminiCaption} />}
            </div>
            )
        };

        const SettingsTab = ({ user, theme, toggleTheme, onLogout, apiKey, onSaveApiKey, onShowTutorial }) => {
            const glassClass = theme === 'dark' ? 'bg-neutral-900/40 border-white/5' : 'bg-white/60 border-black/5';
            const textMain = theme === 'dark' ? 'text-white' : 'text-neutral-900';
            const textMuted = theme === 'dark' ? 'text-neutral-400' : 'text-neutral-500';
            const itemHover = theme === 'dark' ? 'hover:bg-white/5' : 'hover:bg-black/5';
            const [keyInput, setKeyInput] = useState(apiKey);
            const [isDeleting, setIsDeleting] = useState(false);
            const [sliderVal, setSliderVal] = useState(0);

            const handleSave = () => { onSaveApiKey(keyInput); alert("API Key Saved!"); };
            const handleDelete = (e) => { const val = e.target.value; setSliderVal(val); if (parseInt(val) === 100) { setTimeout(() => { alert("Account Permanently Deleted"); onLogout(); }, 200); } };
            const resetDelete = () => { setIsDeleting(false); setSliderVal(0); };

            return (
                <div className="animate-in fade-in duration-700 space-y-8 max-w-2xl mx-auto pb-24">
                    <div><h2 className={`text-3xl md:text-4xl font-bold tracking-tight bg-clip-text text-transparent bg-gradient-to-r ${theme === 'dark' ? 'from-white to-neutral-500' : 'from-neutral-900 to-neutral-500'}`}>Settings</h2></div>
                    <div className={`${glassClass} backdrop-blur-xl border rounded-[32px] overflow-hidden`}>
                        <div className="p-6 border-b border-white/5">
                            <div className="flex items-center justify-between mb-4"><h3 className={`text-sm font-bold uppercase tracking-widest ${textMuted}`}>AI Configuration</h3><a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener noreferrer" className={`flex items-center gap-1 text-[10px] font-bold uppercase tracking-widest hover:underline ${theme === 'dark' ? 'text-indigo-400' : 'text-indigo-600'}`}>Get API Key <ExternalLink size={10} /></a></div>
                            <div className="flex gap-2"><div className={`flex-1 flex items-center gap-2 px-4 py-3 rounded-2xl border transition-colors ${theme === 'dark' ? 'bg-black/30 border-white/10' : 'bg-white border-black/10'}`}><Key size={16} className={textMuted} /><input type="password" value={keyInput} onChange={(e) => setKeyInput(e.target.value)} placeholder="Paste your Google AI Studio Key" className={`bg-transparent w-full outline-none text-sm ${textMain}`} style={{fontSize: '16px'}} /></div><button onClick={handleSave} className={`px-4 py-2 rounded-2xl font-bold text-sm transition-all ${theme === 'dark' ? 'bg-white text-black hover:bg-neutral-200' : 'bg-black text-white hover:bg-neutral-800'}`}>Save</button></div>
                        </div>
                        <div className="p-6 border-b border-white/5"><h3 className={`text-sm font-bold uppercase tracking-widest ${textMuted} mb-4`}>Appearance</h3><div className={`flex items-center justify-between p-3 rounded-2xl transition-colors cursor-pointer ${itemHover}`} onClick={toggleTheme}><div className="flex items-center gap-3"><div className={`p-2 rounded-full ${theme === 'dark' ? 'bg-indigo-500/20 text-indigo-400' : 'bg-orange-500/20 text-orange-500'}`}>{theme === 'dark' ? <Moon size={20} /> : <Sun size={20} />}</div><div><div className={`font-semibold ${textMain}`}>Dark Mode</div></div></div><div className={`w-12 h-6 rounded-full p-1 transition-colors ${theme === 'dark' ? 'bg-indigo-600' : 'bg-neutral-300'}`}><div className={`w-4 h-4 rounded-full bg-white shadow-sm transition-transform ${theme === 'dark' ? 'translate-x-6' : 'translate-x-0'}`}></div></div></div></div>
                        <div className="p-6 border-b border-white/5"><h3 className={`text-sm font-bold uppercase tracking-widest ${textMuted} mb-4`}>Account</h3><div className="space-y-2"><div className={`w-full flex items-center justify-between p-3 rounded-2xl transition-colors ${theme === 'dark' ? 'bg-white/5' : 'bg-black/5'}`}><div className="flex items-center gap-3"><div className={`p-2 rounded-full bg-pink-500/10 text-pink-500`}><Instagram size={20} /></div><div><div className={`font-semibold ${textMain}`}>Instagram Linked</div><div className="text-xs text-neutral-500">@{user?.username || 'user'}</div></div></div><button onClick={onLogout} className="px-3 py-1.5 bg-red-500/10 hover:bg-red-500/20 text-red-500 text-xs font-bold rounded-lg transition-colors">Disconnect</button></div><button onClick={onLogout} className={`w-full flex items-center justify-between p-3 rounded-2xl transition-colors ${itemHover}`}><div className="flex items-center gap-3"><div className={`p-2 rounded-full bg-neutral-500/10 ${textMuted}`}><LogOut size={20} /></div><div className={`font-semibold ${textMain}`}>Log Out</div></div></button></div></div>
                        <div className="p-6"><h3 className={`text-sm font-bold uppercase tracking-widest text-red-500/80 mb-4`}>Danger Zone</h3>{!isDeleting ? <button onClick={() => setIsDeleting(true)} className={`w-full flex items-center gap-3 p-3 rounded-2xl transition-colors hover:bg-red-500/10 text-red-500 group`}><div className={`p-2 rounded-full bg-red-500/10 group-hover:bg-red-500/20`}><Shield size={20} /></div><div className="text-left"><div className="font-semibold">Delete Account</div><div className="text-xs opacity-70">This action cannot be undone</div></div></button> : <div className="bg-red-500/5 rounded-2xl p-4 border border-red-500/20 animate-in fade-in zoom-in duration-300"><div className="flex justify-between items-center mb-4"><span className="text-sm font-bold text-red-500">Are you sure?</span><button onClick={resetDelete} className="text-xs text-neutral-500 hover:text-white">Cancel</button></div><div className="relative h-12 bg-neutral-900 rounded-full overflow-hidden border border-white/10"><div className="absolute inset-0 flex items-center justify-center text-[10px] uppercase font-bold tracking-widest text-white/20 pointer-events-none">Slide to Delete</div><div className="absolute top-0 left-0 bottom-0 bg-red-600 transition-all duration-75 ease-out opacity-50" style={{ width: `${sliderVal}%` }}></div><input type="range" min="0" max="100" value={sliderVal} onChange={handleDelete} className="absolute inset-0 w-full h-full opacity-0 cursor-pointer" /><div className="absolute top-1 bottom-1 w-10 bg-white rounded-full shadow-lg pointer-events-none transition-all duration-75 ease-out flex items-center justify-center text-black" style={{ left: `calc(${sliderVal}% - ${sliderVal * 0.4}px)` }}><Trash2 size={14} className={sliderVal > 90 ? 'text-red-600' : 'text-black'}/></div></div></div>}</div>
                    </div>
                    <button onClick={onShowTutorial} className={`w-full text-center text-xs font-bold uppercase tracking-widest ${textMuted} hover:underline`}>Show Tutorial Again</button>
                </div>
            );
        };

        const Analytics = ({ user, theme }) => {
            const glassClass = theme === 'dark' ? 'bg-neutral-900/40 border-white/5' : 'bg-white/60 border-black/5';
            const textTitle = theme === 'dark' ? 'text-white' : 'text-neutral-900';
            const textMuted = theme === 'dark' ? 'text-neutral-400' : 'text-neutral-500';

            return (
            <div className="animate-in fade-in duration-700 space-y-8">
                <div><h2 className={`text-3xl md:text-4xl font-bold tracking-tight bg-clip-text text-transparent bg-gradient-to-r ${theme === 'dark' ? 'from-white to-neutral-500' : 'from-neutral-900 to-neutral-500'}`}>Insights</h2><p className={`${textMuted} mt-1`}>Growth metrics.</p></div>
                <div className="grid grid-cols-1 md:grid-cols-3 gap-6"><GlassStat icon={Users} label="Followers" value={user.followers} trend="+12%" color="text-indigo-400" theme={theme} /><GlassStat icon={TrendingUp} label="Engagement" value="8.4%" trend="+2.1%" color="text-fuchsia-400" theme={theme} /><GlassStat icon={Eye} label="Reach" value="124k" trend="+5.4%" color="text-blue-400" theme={theme} /></div>
                <div className="grid grid-cols-1 lg:grid-cols-3 gap-6"><div className={`lg:col-span-2 ${glassClass} backdrop-blur-xl border p-8 rounded-[32px] shadow-lg`}><h3 className={`font-bold mb-8 text-lg ${textTitle}`}>Weekly Engagement</h3><div className="h-64 flex items-end justify-between gap-4 px-2">{[45, 60, 35, 80, 70, 90, 100].map((h, i) => (<div key={i} className="flex-1 flex flex-col items-center gap-3 group"><div className={`w-full rounded-t-2xl relative overflow-hidden h-full ${theme === 'dark' ? 'bg-white/5' : 'bg-black/5'}`}><div className="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-indigo-600 to-fuchsia-600 rounded-t-2xl transition-all duration-1000 ease-out opacity-80 group-hover:opacity-100" style={{ height: `${h}%` }}></div></div><span className={`text-xs font-medium ${textMuted}`}>{['M','T','W','T','F','S','S'][i]}</span></div>))}</div></div><div className={`${glassClass} backdrop-blur-xl border p-8 rounded-[32px] shadow-lg`}><h3 className={`font-bold mb-6 text-lg ${textTitle}`}>Top Aesthetics</h3><div className="space-y-6"><StyleBar label="Hyper Realistic" percent="92%" color="bg-indigo-500" theme={theme} /><StyleBar label="Cyberpunk" percent="68%" color="bg-fuchsia-500" theme={theme} /><StyleBar label="Cinematic" percent="45%" color="bg-blue-500" theme={theme} /></div></div></div>
            </div>
            )
        };

        const App = () => {
            const [isLoading, setIsLoading] = useState(true);
            const [isConnected, setIsConnected] = useState(false);
            const [activeTab, setActiveTab] = useState('generate');
            const [user, setUser] = useState(null);
            const [theme, setTheme] = useState('dark'); 
            const [apiKey, setApiKey] = useState(localStorage.getItem('gemini_api_key') || '');
            const [showTutorial, setShowTutorial] = useState(false);
            const [showTooltips, setShowTooltips] = useState(false);
            
            useEffect(() => {
                const timer = setTimeout(() => { setIsLoading(false); }, 2000);
                return () => clearTimeout(timer);
            }, []);

            const handleTooltipStepChange = (targetId) => {
                if (targetId.includes('schedule')) setActiveTab('schedule');
                else if (targetId.includes('settings')) setActiveTab('settings');
                else setActiveTab('generate');
            };

            const [scheduledPosts, setScheduledPosts] = useState([]);

            const [autoPilot, setAutoPilot] = useState({ active: false, topic: '', intervalMs: 15000, nextPostTime: null });
            const [showAutoPilotModal, setShowAutoPilotModal] = useState(false);
            const [pendingAutoTopic, setPendingAutoTopic] = useState("");

            const handleLogin = (customData) => {
                if (customData) { setUser(customData); } else { setUser({ username: "hyper_visuals_ai", name: "Hyper Visuals AI", followers: "12.5k", avatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=instagramUser" }); }
                setIsConnected(true);
                if (!localStorage.getItem('tutorial_seen')) { setTimeout(() => setShowTutorial(true), 800); } else if (!localStorage.getItem('tooltips_seen')) { setShowTooltips(true); }
            };

            const handleCloseTutorial = () => { setShowTutorial(false); localStorage.setItem('tutorial_seen', 'true'); setTimeout(() => setShowTooltips(true), 500); };
            const handleFinishTooltips = () => { setShowTooltips(false); localStorage.setItem('tooltips_seen', 'true'); setActiveTab('generate'); };
            const handleSaveApiKey = (key) => { setApiKey(key); localStorage.setItem('gemini_api_key', key); };
            const handleAddPost = (newPost) => { setScheduledPosts(prev => [...prev, newPost].sort((a, b) => new Date(a.date) - new Date(b.date))); setActiveTab('schedule'); };

            const generateImage = async (prompt, seed) => {
                if (apiKey) {
                    try {
                        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-001:predict?key=${apiKey}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ instances: [{ prompt: prompt }], parameters: { sampleCount: 1 } })
                        });
                        if (response.ok) {
                            const data = await response.json();
                            const base64Image = data.predictions?.[0]?.bytesBase64Encoded;
                            if (base64Image) return `data:image/png;base64,${base64Image}`;
                        }
                    } catch (e) { console.warn("Google Imagen failed", e); }
                }
                return `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?width=1080&height=1350&nologo=true&seed=${seed}`;
            };

            const generateGeminiCaption = async (topic, style) => {
                if (!apiKey) return null;
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: `Write a short, engaging Instagram caption for "${topic}" in style "${style}" with 3 hashtags. Return plain text only.` }] }]
                        })
                    });
                    const data = await response.json();
                    return data.candidates?.[0]?.content?.parts?.[0]?.text;
                } catch (e) { return null; }
            };

            const handleAutoPost = async () => {
                const now = new Date();
                const angles = ["wide angle", "macro", "aerial", "low angle"];
                const lighting = ["cinematic", "golden hour", "neon", "natural"];
                const styles = ["hyper realistic", "4k", "8k", "vivid"];
                const rAngle = angles[Math.floor(Math.random() * angles.length)];
                const rLight = lighting[Math.floor(Math.random() * lighting.length)];
                const rStyle = styles[Math.floor(Math.random() * styles.length)];
                const seed = Math.floor(Math.random() * 1000000);
                const prompt = `${autoPilot.topic}, ${rAngle}, ${rLight}, ${rStyle}`;
                let captionText = `ðŸ¤– Auto-Pilot: ${autoPilot.topic} #AI #${autoPilot.topic.replace(/\s+/g, '')}`;
                const geminiCaption = await generateGeminiCaption(autoPilot.topic, rStyle);
                if (geminiCaption) captionText = geminiCaption;
                const imageUrl = await generateImage(prompt, seed);
                const newPost = { id: Date.now(), imageUrl: imageUrl, caption: captionText, date: now.toISOString(), status: 'posted' };
                setScheduledPosts(prev => [newPost, ...prev].sort((a, b) => new Date(a.date) - new Date(b.date)));
                setAutoPilot(prev => ({ ...prev, nextPostTime: new Date(Date.now() + autoPilot.intervalMs) }));
            };

            const handleDeletePost = (id) => setScheduledPosts(scheduledPosts.filter(p => p.id !== id));
            const toggleTheme = () => setTheme(prev => prev === 'dark' ? 'light' : 'dark');
            const bgClass = theme === 'dark' ? 'bg-black text-white' : 'bg-neutral-100 text-neutral-900';
            const glassClass = theme === 'dark' ? 'bg-neutral-900/40 border-white/10' : 'bg-white/60 border-black/5';
            const textMuted = theme === 'dark' ? 'text-neutral-400' : 'text-neutral-500';

            if (isLoading) return <LoadingScreen />;
            if (!isConnected) return <LoginScreen onLogin={handleLogin} theme={theme} />;

            return (
                <div className={`min-h-screen font-sans flex flex-col md:flex-row relative overflow-hidden transition-colors duration-500 ${bgClass}`}>
                    <div className="fixed inset-0 z-0 pointer-events-none">
                        <div className={`absolute top-[-10%] left-[-10%] w-[50%] h-[50%] rounded-full blur-[120px] animate-pulse-slow ${theme === 'dark' ? 'bg-indigo-600/20' : 'bg-indigo-400/20'}`}></div>
                        <div className={`absolute bottom-[-10%] right-[-10%] w-[50%] h-[50%] rounded-full blur-[120px] animate-pulse-slow delay-1000 ${theme === 'dark' ? 'bg-fuchsia-600/20' : 'bg-fuchsia-400/20'}`}></div>
                    </div>

                    {autoPilot.active && (
                        <div className="fixed top-4 left-4 right-4 z-[100] mx-auto max-w-md animate-slide-up">
                            <AutoPilotStatus autoPilot={autoPilot} theme={theme} onPostTrigger={handleAutoPost} onStop={() => setAutoPilot(prev => ({ ...prev, active: false, nextPostTime: null }))} />
                        </div>
                    )}

                    <aside className={`hidden md:flex flex-col w-24 lg:w-72 fixed left-4 top-4 bottom-4 z-50 backdrop-blur-2xl border rounded-[32px] shadow-2xl p-6 ${glassClass}`}>
                        <div className="flex items-center gap-3 mb-10 pl-2">
                            <div className="w-10 h-10 rounded-2xl bg-gradient-to-tr from-indigo-500 to-fuchsia-500 flex items-center justify-center shadow-lg"><Ghost className="text-white w-10 h-10" /></div>
                            <span className="hidden lg:block text-xl font-bold tracking-tight">Ghost</span>
                        </div>
                        <nav className="flex flex-col gap-2 flex-1">
                            <NavItem id="nav-generate" icon={Wand2} label="Generator" active={activeTab === 'generate'} onClick={() => setActiveTab('generate')} theme={theme} />
                            <NavItem id="nav-schedule" icon={Calendar} label="Scheduler" count={scheduledPosts.filter(p => new Date(p.date) > new Date()).length} active={activeTab === 'schedule'} onClick={() => setActiveTab('schedule')} theme={theme} />
                            <NavItem id="nav-analytics" icon={BarChart3} label="Analytics" active={activeTab === 'analytics'} onClick={() => setActiveTab('analytics')} theme={theme} />
                            <NavItem id="nav-settings" icon={Settings} label="Settings" active={activeTab === 'settings'} onClick={() => setActiveTab('settings')} theme={theme} />
                        </nav>
                        <div className="lg:hidden mt-auto flex justify-center"><img src={user.avatar} className={`w-8 h-8 rounded-full border ${theme === 'dark' ? 'border-white/10' : 'border-black/10'}`} alt="Profile" /></div>
                    </aside>

                    <main className="flex-1 md:ml-32 lg:ml-80 p-4 md:p-6 pb-40 relative z-10 h-screen overflow-y-auto no-scrollbar scroll-smooth">
                        <div className="max-w-6xl mx-auto space-y-8 pt-12 md:pt-4">
                            <div key={activeTab} className="animate-slide-up">
                                {activeTab === 'generate' && <Generator user={user} onSchedule={handleAddPost} theme={theme} autoPilot={autoPilot} setAutoPilot={setAutoPilot} setShowAutoPilotModal={setShowAutoPilotModal} setPendingAutoTopic={setPendingAutoTopic} pendingAutoTopic={pendingAutoTopic} generateGeminiCaption={generateGeminiCaption} generateImage={generateImage} />}
                                {activeTab === 'schedule' && <Scheduler posts={scheduledPosts} onDelete={handleDeletePost} onAdd={handleAddPost} theme={theme} generateGeminiCaption={generateGeminiCaption} />}
                                {activeTab === 'analytics' && <Analytics user={user} theme={theme} />}
                                {activeTab === 'settings' && <SettingsTab user={user} theme={theme} toggleTheme={toggleTheme} onLogout={() => setIsConnected(false)} apiKey={apiKey} onSaveApiKey={handleSaveApiKey} onShowTutorial={() => setShowTutorial(true)} />}
                            </div>
                        </div>
                    </main>

                    <nav className={`md:hidden fixed bottom-6 left-4 right-4 h-16 backdrop-blur-xl border rounded-full shadow-2xl z-50 flex items-center justify-around px-2 ${glassClass} ${theme === 'dark' ? 'bg-neutral-900/90' : 'bg-white/90'}`}>
                        <MobileNavItem id="nav-generate" icon={Wand2} active={activeTab === 'generate'} onClick={() => setActiveTab('generate')} theme={theme} />
                        <MobileNavItem id="nav-schedule" icon={Calendar} active={activeTab === 'schedule'} onClick={() => setActiveTab('schedule')} count={scheduledPosts.length} theme={theme} />
                        <MobileNavItem id="nav-analytics" icon={BarChart3} active={activeTab === 'analytics'} onClick={() => setActiveTab('analytics')} theme={theme} />
                        <MobileNavItem id="nav-settings" icon={Settings} active={activeTab === 'settings'} onClick={() => setActiveTab('settings')} theme={theme} />
                    </nav>

                    {showAutoPilotModal && <AutoPilotConfigModal theme={theme} onClose={() => setShowAutoPilotModal(false)} onConfirm={(intervalMs) => {
                        setAutoPilot({ active: true, topic: pendingAutoTopic, intervalMs: intervalMs, nextPostTime: new Date(Date.now() + intervalMs) });
                        setShowAutoPilotModal(false);
                    }} />}

                    {showTutorial && <TutorialModal onClose={handleCloseTutorial} theme={theme} />}
                    {showTooltips && <TooltipSystem active={showTooltips} onComplete={handleFinishTooltips} onStepChange={handleTooltipStepChange} />}
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>